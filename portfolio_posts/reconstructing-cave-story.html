<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_project_goals">Project Goals</a>
<ul class="sectlevel2">
<li><a href="#_what_is_cave_story">What is Cave Story?</a></li>
</ul>
</li>
<li><a href="#_project_progress">Project Progress</a>
<ul class="sectlevel2">
<li><a href="#_summary">Summary</a></li>
<li><a href="#_demonstration">Demonstration</a></li>
</ul>
</li>
<li><a href="#_code_organization">Code Organization</a>
<ul class="sectlevel2">
<li><a href="#_abstractions">Abstractions</a></li>
<li><a href="#_game_units">Game Units</a></li>
</ul>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://www.youtube.com/playlist?list=PL006xsVEsbKjSKBmLu1clo85yLrwjY67X">Video Series</a>
<a href="https://github.com/chebert/cavestory-screencast">Project Source Code</a>
<a href="https://www.reddit.com/r/reconstructcavestory/">Project Forum</a></p>
</div>
<div class="sect1">
<h2 id="_project_goals">Project Goals</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Faithfully reconstruct the 2D Platformer: Cave Story</p>
</li>
<li>
<p>Explain theory and every line of code on camera</p>
<div class="ulist">
<ul>
<li>
<p>Do all coding on video, even fixing mistakes</p>
</li>
<li>
<p>Don&#8217;t plan ahead, show complexity of design</p>
</li>
</ul>
</div>
</li>
<li>
<p>Engage an audience and adjust content to meet audience needs</p>
</li>
<li>
<p>Written in C++ &amp; SDL</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_what_is_cave_story">What is Cave Story?</h3>
<div class="paragraph">
<p>Cave Story is a 2D platformer Indie Game created by a single Japanese man under the pseudonym "Pixel".
It tells the story of a robot who finds himself in the underground caves of a floating island.</p>
</div>
<div class="ulist">
<div class="title">Some of Cave Story&#8217;s Features</div>
<ul>
<li>
<p>Explorable environments</p>
</li>
<li>
<p>Multiple selectable weapons and upgrades</p>
</li>
<li>
<p>Unique level-up system for weapons</p>
</li>
<li>
<p>Jump mechanics</p>
</li>
<li>
<p>Enemies each with unique behaviors</p>
</li>
<li>
<p>Boss fights</p>
</li>
<li>
<p>Cutscenes and Dialogue</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./portfolio_posts/cave-story/cave-story-doritos.png" alt="cave story doritos">
</div>
<div class="title">Figure 1. Cave Story features dozens of enemy types, each with unique behaviors.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./portfolio_posts/cave-story/cave-story-bubbler.png" alt="cave story bubbler">
</div>
<div class="title">Figure 2. Cave Story has many unique weapon types.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./portfolio_posts/cave-story/cave-story-sand.png" alt="cave story sand">
</div>
<div class="title">Figure 3. Cave Story has many locales and environments</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_project_progress">Project Progress</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>80+ Videos</p>
<div class="ulist">
<ul>
<li>
<p>70+ "Episodes"</p>
</li>
<li>
<p>80k+ views</p>
</li>
</ul>
</div>
</li>
<li>
<p>C++ using SDL1.2 Library and some Boost libraries</p>
</li>
<li>
<p>Spawned many re-writes from followers in other languages, demonstrating the clarity of the ideas presented in the videos</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/drbawb/rust-story">drbawb&#8217;s Rust Story</a></p>
</li>
<li>
<p><a href="https://github.com/JIghtuse/cavestory-sdl2">Cave Story written using modern C++ and SDL2</a></p>
</li>
<li>
<p><a href="https://github.com/mystal/cavestory-pysdl2">Cave Story in Python</a></p>
</li>
<li>
<p>Many Others!</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_summary">Summary</h3>
<div class="olist arabic">
<div class="title">Summary of what was accomplished on video</div>
<ol class="arabic">
<li>
<p>Sprite Animations; Episode 4</p>
</li>
<li>
<p>Player Movement; Episode 9</p>
</li>
<li>
<p>Tile Maps; Episode 11</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Player/Tile Collisions; Episode 13</p>
</li>
</ol>
</div>
</li>
<li>
<p>Resolution-independent units; Episode 18</p>
</li>
<li>
<p>Enemies; Episode 20</p>
</li>
<li>
<p>Damage/Health; Episode 28</p>
</li>
<li>
<p>HUD; Episode 28</p>
</li>
<li>
<p>Weapons; Episode 34</p>
</li>
<li>
<p>Projectiles; Episode 36</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Projectile Collisions Episode 38</p>
</li>
</ol>
</div>
</li>
<li>
<p>Particle Effects; Episode 48</p>
</li>
<li>
<p>Gun Experience/Leveling Up; Episode 51</p>
</li>
<li>
<p>Pickups: Health, Experience; Episode 59</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Bouncing objects; interact with environment; Episode 57</p>
</li>
</ol>
</div>
</li>
<li>
<p>Tile Slopes; Episode 66</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_demonstration">Demonstration</h3>
<div class="imageblock">
<div class="content">
<img src="./portfolio_posts/cave-story/cave-story-animated-sprite.gif" alt="cave story animated sprite">
</div>
<div class="title">Figure 4. Episode 4; Demonstration of Animated Sprites</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./portfolio_posts/cave-story/cave-story-problem-solution.png" alt="cave story problem solution">
</div>
<div class="title">Figure 5. Episode 9; Problem-solution approach</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./portfolio_posts/cave-story/cave-story-jumping.gif" alt="cave story jumping">
</div>
<div class="title">Figure 6. Episode 9; Demonstration of Player Movement</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./portfolio_posts/cave-story/cave-story-slide.png" alt="cave story slide">
</div>
<div class="title">Figure 7. Episode 12; Explaining Tile Collisions</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./portfolio_posts/cave-story/cave-story-damage.gif" alt="cave story damage">
</div>
<div class="title">Figure 8. Episode 22; Taking damage from the bat enemy</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./portfolio_posts/cave-story/cave-story-polar-star.gif" alt="cave story polar star">
</div>
<div class="title">Figure 9. Episode 40.3; Shooting a gun and damage effects</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./portfolio_posts/cave-story/reconstructing-cave-story-doritos.png" alt="reconstructing cave story doritos">
</div>
<div class="title">Figure 10. Episode 70; Pickups and bouncing power crystals</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_code_organization">Code Organization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This project uses an Object-Oriented approach to code organization.
A strong attempt was made to follow the "best practices" laid out in "Effective C" by Scott Meyers.
Code style used the https://google.github.io/styleguide/cppguide.html[Google C Style Guide], with some flexibility.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Constants prefixed with <code>k</code>, using camel case: <code>kConstantName</code></p>
</li>
<li>
<p>Member variables suffixed with <code>_</code>, using snake case: <code>member_variable_name_</code></p>
</li>
<li>
<p>Classes start with capital letters, using camel case: <code>ClassName</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When doing the design, I tried to maximize "information hiding" to increase the simplicity.
However, I think that I leaned a bit too hard into this and it resulted in adding complexity.</p>
</div>
<div class="sect2">
<h3 id="_abstractions">Abstractions</h3>
<div class="paragraph">
<p>I tried to re-use code whenever possible, but put off creating abstractions until there was code being used in multiple places.
This resulted in some unique abstractions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kinematics. A kinematics object holds the position and velocity of an object at a given time along a single axis; e.g. the x position an x velocity.</p>
</li>
<li>
<p>Accelerators. An accelerator object updates a kinematics object according to some pattern.
Example accelerators are FrictionAccelerator, GravityAccelerator, and ConstantAccelerator.
Making these into an object made sense, since friction for example is dependent on the velocity.
A character may have a gravity accelerator applied to the y direction kinematics and friction applied to the x direction kinematics.</p>
</li>
<li>
<p>Composite Collision Rectangle.
The main character&#8217;s collision box is actually made up of 4 collision boxes, one for each of top, left, bottom, and right.
A composite collision rectangle combines these four rectangles to treat them as one collision rectangle.</p>
</li>
<li>
<p>Particle. A particle is an entity that is updated and drawn, does not interact with the environment, and has a short lifespan.
Examples include ProjectileStarParticle, ProjectileWallParticle, and DeathCloudParticle.</p>
</li>
<li>
<p>Pickup. A pickup is an entity that provides some status-boosting effect when colliding with the player, is updated and drawn, has a short lifespan.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Kinematics Class</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="c++"><span></span><span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 1 </span><span style="color: #008000; font-weight: bold">struct</span> Kinematics {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 2 </span>   Kinematics(
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 3 </span>         units<span style="color: #666666">::</span>Game position,
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 4 </span>         units<span style="color: #666666">::</span>Velocity velocity)<span style="color: #666666">:</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 5 </span>      position(position),
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 6 </span>      velocity(velocity) {}
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 7 </span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 8 </span>   units<span style="color: #666666">::</span>Game position;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 9 </span>   units<span style="color: #666666">::</span>Velocity velocity;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">10 </span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">11 </span>   units<span style="color: #666666">::</span>Game delta(units<span style="color: #666666">::</span>MS elapsed_time) { <span style="color: #008000; font-weight: bold">return</span> velocity <span style="color: #666666">*</span> elapsed_time; }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">12 </span>};
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">13 </span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">14 </span><span style="color: #008000; font-weight: bold">struct</span> Kinematics2D {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">15 </span>   Position2D position() <span style="color: #008000; font-weight: bold">const</span> { <span style="color: #008000; font-weight: bold">return</span> Position2D(x.position, y.position); }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">16 </span>   Velocity2D velocity() <span style="color: #008000; font-weight: bold">const</span> { <span style="color: #008000; font-weight: bold">return</span> Velocity2D(x.velocity, y.velocity); }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">17 </span>   Kinematics x, y;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">18 </span>};</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Accelerators</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="c++"><span></span><span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 1 </span><span style="color: #008000; font-weight: bold">struct</span> Accelerator {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 2 </span>   <span style="color: #008000; font-weight: bold">virtual</span> <span style="color: #B00040">void</span> updateVelocity(Kinematics<span style="color: #666666">&amp;</span> kinematics, units<span style="color: #666666">::</span>MS elapsed_time) <span style="color: #008000; font-weight: bold">const</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 3 </span>   <span style="color: #008000; font-weight: bold">virtual</span> <span style="color: #666666">~</span>Accelerator() <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 4 </span>};
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 5 </span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 6 </span><span style="color: #408080; font-style: italic">// Friction Accelerator derives Accelerator</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 7 </span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 8 </span><span style="color: #B00040">void</span> FrictionAccelerator<span style="color: #666666">::</span>updateVelocity(Kinematics<span style="color: #666666">&amp;</span> kinematics, units<span style="color: #666666">::</span>MS elapsed_time) <span style="color: #008000; font-weight: bold">const</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 9 </span>   kinematics.velocity <span style="color: #666666">=</span> kinematics.velocity <span style="color: #666666">&gt;</span> <span style="color: #666666">0.0f</span> <span style="color: #666666">?</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">10 </span>      std<span style="color: #666666">::</span>max(<span style="color: #666666">0.0f</span>, kinematics.velocity <span style="color: #666666">-</span> friction_ <span style="color: #666666">*</span> elapsed_time) <span style="color: #666666">:</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">11 </span>      std<span style="color: #666666">::</span>min(<span style="color: #666666">0.0f</span>, kinematics.velocity <span style="color: #666666">+</span> friction_ <span style="color: #666666">*</span> elapsed_time);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">12 </span>}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Particles</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="c++"><span></span><span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 1 </span><span style="color: #008000; font-weight: bold">struct</span> Particle {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 2 </span>   <span style="color: #408080; font-style: italic">// update returns false when the Particle&#39;s lifespan has expired.</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 3 </span>   <span style="color: #008000; font-weight: bold">virtual</span> <span style="color: #B00040">bool</span> update(units<span style="color: #666666">::</span>MS elapsed_time) <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 4 </span>   <span style="color: #008000; font-weight: bold">virtual</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">draw</span>(Graphics<span style="color: #666666">&amp;</span> graphics) <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 5 </span>   <span style="color: #008000; font-weight: bold">virtual</span> <span style="color: #666666">~</span>Particle() <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 6 </span>};
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 7 </span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 8 </span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 9 </span><span style="color: #408080; font-style: italic">// DeathCloudParticle derives Particle</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">10 </span><span style="color: #408080; font-style: italic">// DeathCloudParticle has sprite_, offset_ and speed_ as member variables.</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">11 </span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">12 </span><span style="color: #B00040">bool</span> DeathCloudParticle<span style="color: #666666">::</span>update(units<span style="color: #666666">::</span>MS elapsed_time) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">13 </span>   sprite_.update();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">14 </span>   offset_.magnitude <span style="color: #666666">+=</span> speed_ <span style="color: #666666">*</span> elapsed_time;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">15 </span>   <span style="color: #008000; font-weight: bold">return</span> sprite_.num_completed_loops() <span style="color: #666666">==</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">16 </span>}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_game_units">Game Units</h3>
<div class="paragraph">
<p>Cave Story+, a re-release of Cave Story, has two resolutions: the original using 16x16 pixel tiles and an updated resolution using 32x32 pixel tiles.
In order to facilitate both, a Game Unit was used. All positions, velocities, and accelarations, were converted to use the Game Unit before any calculations were done.</p>
</div>
<div class="listingblock">
<div class="title">Example Conversion Functions</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="c++"><span></span><span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 1 </span><span style="color: #008000; font-weight: bold">typedef</span> <span style="color: #B00040">float</span> Game; <span style="color: #408080; font-style: italic">// Float for extra precision. Intrisic units of position.</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 2 </span><span style="color: #008000; font-weight: bold">typedef</span> <span style="color: #B00040">int</span> Pixel; <span style="color: #408080; font-style: italic">// Integer for discrete units. Pixel values can be +/-.</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 3 </span><span style="color: #008000; font-weight: bold">typedef</span> <span style="color: #B00040">unsigned</span> <span style="color: #B00040">int</span> Tile; <span style="color: #408080; font-style: italic">// Also discrete, but non-negative.</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 4 </span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 5 </span><span style="color: #408080; font-style: italic">// HIGH_QUALITY means high resolution, 32x32 pixel tiles.</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 6 </span><span style="color: #008000; font-weight: bold">inline</span> Pixel <span style="color: #0000FF">gameToPixel</span>(Game game) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 7 </span>   <span style="color: #008000; font-weight: bold">return</span> config<span style="color: #666666">::</span>getGraphicsQuality() <span style="color: #666666">==</span> config<span style="color: #666666">::</span>HIGH_QUALITY <span style="color: #666666">?</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 8 </span>      Pixel(round(game)) <span style="color: #666666">:</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 9 </span>      Pixel(round(game <span style="color: #666666">/</span> <span style="color: #666666">2</span>));
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">10 </span>}
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">11 </span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">12 </span><span style="color: #008000; font-weight: bold">inline</span> Tile <span style="color: #0000FF">gameToTile</span>(Game game) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">13 </span>   <span style="color: #008000; font-weight: bold">return</span> Tile(game <span style="color: #666666">/</span> kTileSize);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">14 </span>}</code></pre>
</div>
</div>
</div>
</div>
</div>